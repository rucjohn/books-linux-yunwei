# Linux 内核

## 内存寻址

CPU 内存寻址过程中有三种地址：
- ***逻辑地址***，CPU 中用来指定一个操作数或指令的地址
- ***线性地址***，也叫虚拟地址，是介于逻辑地址和物理地址之间存在的一种地址
- ***物理地址***，物理内存中数据的地址

CPU 是如何找到内存中的物理地址的？**CPU 通过内存管理单元（MMU）来完成地址转换的。**
1. MMU通过分段单元将逻辑地址转换成线性地址
2. MMU通过分页单元将线性地址转换成物理地址

### 分段

逻辑地址由 16 位段选择符和 32 位偏移量组成。

段描述符，用来描述段的特征，比如基地址、段长等，它共 8 字节。

CPU 中的段寄存器专门用来存放段选择符的，每当段选择符被装入段寄存器时，对应的段描述符就被装入非编程的寄存器中。

CPU 在内存寻址时，根据段选择符找到段描述符，然后从段描述符中找到段基地址，再加上逻辑地址的偏移量，这样就找到了线性地址。

### 分页

线性地址被分成以固定长度为单元的组，称为页。

分页单元把内存也分成以固定长度为单元的组，称为页框，也称物理页。

页指的是一个数据块，页框指的是一块存储区域。页和页框的长度是一致的。

页表是线性地址映射成物理地址的数据结构。

**32 位系统**：把线性地址分成 3 个部分：目录（Directory）、页表（Table）和 偏移量（Offset），二级模式（10+10+12）

**64 位系统**：把线性地址分成 5 个部分：页全局目录、页上级目录、页中间目录、页表和偏移量，四级模式（9+9+9+9+12）

***Offset 字段决定了页框的相对位置，它是 12 位长，故每页含有 $$2^{12} = 4096$$ 字节（4KB）的数据。***

线性地址的每级页目录都包含有目录项，目录项指向下一级页目录地址，最后一级页目录项指定页表，页表的表项含有所有页框的物理地址，这就完成了线性地址到物理地址的转换。

